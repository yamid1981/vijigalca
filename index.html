<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="static/css/style.css" type="text/css" >
  <script src="static/js/highcharts.js"></script>
  <title>–°—Ç–æ–π–∫–∏ ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–æ–≤</title>
  
</head>
<body>
<!-- <div id="proba"></div> -->
<div style="
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    gap: 24px; 
    padding: 25px; 
    background: #ffffff; 
    border-radius: 16px; 
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
">
<!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div style="flex: 1;">
    <div style="font-size: 0.9em; color: #888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
    <div id="vip" style="font-size: 2.2em; font-weight: 800; color: #1a1a1a; white-space: nowrap;">
      –í—ã–ø—É—â–µ–Ω–æ: <span style="color: #007AFF;">‚Äî</span>
    </div>
  </div>
<!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
  <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 12px;">
    <div style="display: flex; align-items: center; gap: 10px; background: #f5f5f7; padding: 8px; border-radius: 12px;">
      
      <button onclick="setToday()" id="todayBtn" style="
        background: #fff; border: 1px solid #ddd; padding: 8px 14px; border-radius: 8px; 
        cursor: pointer; font-weight: 500; transition: all 0.2s;
      ">–°–µ–≥–æ–¥–Ω—è</button>
      
      <input type="date" id="date" style="
        border: 1px solid #ddd; padding: 7px 10px; border-radius: 8px; outline: none; font-family: inherit;
      ">
      
      <button onclick="loadData()" id="load" style="
        background: #007AFF; color: white; border: none; padding: 8px 18px; border-radius: 8px; 
        cursor: pointer; font-weight: 600; transition: background 0.2s;
      ">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
      
    </div>
    
    <div id="autoUpdateStatus" style="
      font-size: 0.85em; color: #00b341; font-weight: 500; display: flex; align-items: center; gap: 5px;
    ">
      <span style="width: 8px; height: 8px; background: #00b341; border-radius: 50%; display: inline-block;"></span>
      –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ç–æ–ª—å–∫–æ —á—Ç–æ
    </div>
  </div>
</div>
<!-- <h2 style="text-align: center;">–°—Ç–æ–π–∫–∏ ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–æ–≤</h2> -->
<table id="stoykiTable">
  <thead>
    <tr>
      <th>–°—Ç–æ–π–∫–∞ (–∫–æ–ª-–≤–æ –Ω–∞–∂.)</th>
      <th>–¢–µ–∫. –≤—Ä–µ–º—è</th>
      <th>–°—É–º–º–∞—Ä–Ω–æ–µ</th>
      <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
      <th>–ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø—É—Å–∫–∞ / –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –ª–µ–Ω—Ç–µ</th>
    </tr>
  </thead>
  <tbody id="stoykiBody">
  </tbody>
</table>
<div>
    <li id="sys_time">–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ‚Äî</li>
    <li id="cep_run">–í—Ä–µ–º—è –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–ø–∏: ‚Äî</li>
</div>
<div id="container2" style="height: 35em"></div>
<!-- –ë–ª–æ–∫ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –æ—Å—Ç–∞—ë—Ç—Å—è —Å–∫—Ä—ã—Ç—ã–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
<div id="password" style="display: none;">
  <h2>–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
  <table id="usersTable" style="width:100%; border-collapse: collapse;">
    <thead>
      <tr style="background:#444;">
        <th>–í—Ä–µ–º—è</th>
        <th>IP</th>
        <th>–ö–æ–º–ø—å—é—Ç–µ—Ä</th>
        <th>–ó–∞–ø—Ä–æ—Å–æ–≤</th>
        <th>–ë—Ä–∞—É–∑–µ—Ä / —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</th>
      </tr>
    </thead>
    <tbody id="usersBody"></tbody>
  </table>
</div>
<a href="/plc" style="display: block; text-align: center; margin-top: 20px; color: #888; text-decoration: none;">
    (C) –û—Ç–¥–µ–ª –ê–°–£–¢–ü, –£–ò–¢ –ú–ò–ù–°–ö 2026
</a>

<script>

function isTodaySelected() {
    const selected = document.getElementById("date").value;
    if (!selected) return true;
    const today = new Date().toISOString().slice(0, 10);
    return selected === today;
}
function updateAutoStatus(state = "idle") {
    const el = document.getElementById("autoUpdateStatus");

    // –û—Ç–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –∞—Ä—Ö–∏–≤–Ω—ã—Ö –¥–∞—Ç
    if (!isTodaySelected()) {
        el.textContent = "(–∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ)";
        el.style.color = "#e67e22";
        clearInterval(autoCountdownTimer);
        autoCountdownTimer = null;
        return;
    }

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ: –∏–¥—ë—Ç –∑–∞–≥—Ä—É–∑–∫–∞
    if (state === "loading") {
        el.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞...";
        el.style.color = "#3498db";
        clearInterval(autoCountdownTimer);
        autoCountdownTimer = null;
        return;
    }

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ: –∑–∞–≥—Ä—É–∂–µ–Ω–æ ‚Äî –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç
    if (state === "loaded") {
        el.style.color = "#27ae60";

        let sec = 5;
        el.textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ${sec} —Å–µ–∫`;

        clearInterval(autoCountdownTimer);
        autoCountdownTimer = setInterval(() => {
            sec--;
            if (sec <= 0) {
                el.textContent = "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...";
                clearInterval(autoCountdownTimer);
                autoCountdownTimer = null;
                return;
            }
            el.textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ${sec} —Å–µ–∫`;
        }, 1000);

        return;
    }

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    el.textContent = "(–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫)";
    el.style.color = "#27ae60";
}
let lastGrafData = [];
let updateTimer;
let isLoading = false;
let lastSuccessfulLoadTime = 0;
let autoCountdownTimer = null;
const stopModalTitles = {
  cep:   "–æ—Å—Ç–∞–Ω–æ–≤ –¶–ï–ü–¨",
  inf1:  "–æ—Å—Ç–∞–Ω–æ–≤ –ü–û–ó-1 –ó–∞–∫–ª–∞–¥–∫–∞",
  inf2:  "–æ—Å—Ç–∞–Ω–æ–≤ –ü–û–ó-3 –ú–æ—Å—Ç",
  inf3:  "–æ—Å—Ç–∞–Ω–æ–≤ –ü–û–ó-5 –ö–∞—Ä–¥–∞–Ω",
  inf4:  "–æ—Å—Ç–∞–Ω–æ–≤ –ü–û–ó-7 –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç",
  inf5:  "–æ—Å—Ç–∞–Ω–æ–≤ –ü–û–ó-10 –î–≤–∏–≥–∞—Ç–µ–ª—å",
  inf6:  "–æ—Å—Ç–∞–Ω–æ–≤ –ü–û–ó-14 –†–∞–¥–∏–∞—Ç–æ—Ä",
  inf7:  "–æ—Å—Ç–∞–Ω–æ–≤ –ü–û–ó-23 –ó–∞–ø—Ä–∞–≤–∫–∞",
  inf8:  "–æ—Å—Ç–∞–Ω–æ–≤ –ü–û–ó-26 –ö–∞–±–∏–Ω–∞",
  inf9:  "–æ—Å—Ç–∞–Ω–æ–≤ –ü–û–ó-29 –ù–∞–¥—Ä–∞–º–Ω–∏–∫",
  inf10: "–æ—Å—Ç–∞–Ω–æ–≤ –ù–∞—Ç—è–∂–∏—Ç–µ–ª—å —Ü–µ–ø–∏ (–ø–æ–¥–≤–∞–ª)",
  inf11: "–æ—Å—Ç–∞–Ω–æ–≤ –ü–û–ó-32 –°–ø—É—Å–∫",
  inf12: "–æ—Å—Ç–∞–Ω–æ–≤ FX5U –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä"
};
  // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–∏–π (–∏–º—è –≥—Ä–∞—Ñ–∏–∫–∞, –∏–º—è –ø–æ–ª—è –≤ JSON, –≤—ã—Å–æ—Ç–∞ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ)
  const seriesConfig = [
    { name: '–¶–ï–ü–¨',        field: 'cep_inf',  y: 130 },
    { name: '–ó–ê–ö–õ–ê–î–ö–ê',    field: 'inf1_',    y: 120 },
    { name: '–ú–û–°–¢',        field: 'inf2_',    y: 110 },
    { name: '–ö–ê–†–î–ê–ù',      field: 'inf3_',    y: 100 },
    { name: '–ü–ï–†–ï–í–û–†–û–¢',   field: 'inf4_',    y:  90 },
    { name: '–î–í–ò–ì–ê–¢–ï–õ–¨',   field: 'inf5_',    y:  80 },
    { name: '–†–ê–î–ò–ê–¢–û–†',    field: 'inf6_',    y:  70 },
    { name: '–ó–ê–ü–†–ê–í–ö–ê',    field: 'inf7_',    y:  60 },  
    { name: '–ö–ê–ë–ò–ù–ê',      field: 'inf8_',    y:  50 },
    { name: '–ù–ê–î–†–ê–ú–ù–ò–ö',   field: 'inf9_',    y:  40 },
    { name: '–ü–û–î–í–ê–õ',      field: 'inf10_',   y:  30 },
    { name: '–°–ü–£–°–ö',       field: 'inf11_',   y:  20 },
    { name: '–ö–û–ù–¢–†–û–õ–õ–ï–†',  field: 'inf12_',   y:  10  }
  ];
const positions = [
  { id: "cep",     name: "–¶–ï–ü–¨" },
  { id: "inf1",    name: '–ü–û–ó-1 "–ó–∞–∫–ª–∞–¥–∫–∞"' },
  { id: "inf2",    name: '–ü–û–ó-3 "–ú–æ—Å—Ç"' },
  { id: "inf3",    name: '–ü–û–ó-5 "–ö–∞—Ä–¥–∞–Ω"' },
  { id: "inf4",    name: '–ü–û–ó-7 "–ü–µ—Ä–µ–≤–æ—Ä–æ—Ç"' },
  { id: "inf5",    name: '–ü–û–ó-10 "–î–≤–∏–≥–∞—Ç–µ–ª—å"' },
  { id: "inf6",    name: '–ü–û–ó-14 "–†–∞–¥–∏–∞—Ç–æ—Ä"' },
  { id: "inf7",    name: '–ü–û–ó-23 "–ó–∞–ø—Ä–∞–≤–∫–∞"' },
  { id: "inf8",    name: '–ü–û–ó-26 "–ö–∞–±–∏–Ω–∞"' },
  { id: "inf9",    name: '–ü–û–ó-29 "–ù–∞–¥—Ä–∞–º–Ω–∏–∫"' },
  { id: "inf10",   name: '–ù–∞—Ç—è–∂–∏—Ç–µ–ª—å —Ü–µ–ø–∏ (–ø–æ–¥–≤–∞–ª)' },
  { id: "inf11",   name: "–ü–û–ó-32 –°–ø—É—Å–∫" },
  { id: "inf12",   name: 'FX5U "–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä"' },           
];
function startAutoUpdate() {
    // –ó–∞—â–∏—Ç–∞ –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–∞–π–º–µ—Ä–æ–≤
    if (updateTimer) {
        clearTimeout(updateTimer);
        updateTimer = null;
    }

    // –ï—Å–ª–∏ –ù–ï —Å–µ–≥–æ–¥–Ω—è ‚Äî –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ–º
    if (!isTodaySelected()) {
        console.log("–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ: –≤—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞ –≤ –ø—Ä–æ—à–ª–æ–º");
        return;
    }

    console.log("–ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è");

    updateTimer = setTimeout(() => {
        loadData().then(() => {
            // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ü–µ–ø–æ—á–∫—É
            startAutoUpdate();
        });
    }, 5000);
}
function buildGraf(rows) {
  if (!rows || rows.length < 2) return;

  const raw = rows;

 const dateInput = document.getElementById("date").value;
let baseDate;
if (dateInput && !isNaN(Date.parse(dateInput))) {
  baseDate = new Date(dateInput);
} else {
  baseDate = new Date();   // fallback –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
}
baseDate.setHours(0, 0, 0, 0);

  function parseTimeStr(timeStr) {
    const cleaned = timeStr?.trim();
    if (!cleaned) return null;
    const parts = cleaned.split(":").map(Number);
    if (parts.length < 2) return null;
    const [h, m, s = 0] = parts;
    const d = new Date(baseDate);
    d.setHours(h, m, s, 0);
    return d.getTime();
  }

  const signalNames = [
    'cep_inf', 'inf1_', 'inf2_', 'inf3_', 'inf4_', 'inf5_',
    'inf6_', 'inf7_', 'inf8_', 'inf9_', 'inf10_', 'inf11_', 'inf12_'
  ];

  const seriesData = signalNames.map(name => {
    const seriesPoints = raw
      .map(item => {
        const ts = parseTimeStr(item._data);
        return (ts !== null && !isNaN(ts))
          ? [ts, Number(item[name]) || 0]
          : null;
      })
      .filter(Boolean);

    return {
      name,
      step: 'left',
      data: seriesPoints,
      marker: { enabled: false },
      lineWidth: 2,
      turboThreshold: 0
    };
  });

  Highcharts.stockChart('container', {
    chart: { height: 500 },
    rangeSelector: { /* ... */ },
    navigator: { enabled: true },
    scrollbar: { enabled: true },
    title: { text: '–°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤' },
    xAxis: {
      type: 'datetime',
      ordinal: false,                
      dateTimeLabelFormats: { /* ... */ }
    },
    yAxis: {
      min: 0,
      max: 1.2,
      tickInterval: 1,
      labels: { enabled: false }
    },
    tooltip: { shared: true, valueDecimals: 0 },
    plotOptions: {
      series: { turboThreshold: 0, connectNulls: false }
    },
    series: seriesData
  });
}
const positionLabels = [
  "–ó–ê–î–ê–ù–ò–ï",
  "–§–û–†–ú–ò–†–£–ï–¢–°–Ø",
  "–ü–û–î–í–ê–õ>>>",
  "–ó–ê–ö–õ–ê–î–ö–ê>>>",
  "–£–°–¢–ê–ù–û–í–ö–ê –ú–û–°–¢–ê>>>",
  "–£–°–¢–ê–ù–û–í–ö–ê –ú–û–°–¢–ê>>>",
  "–£–°–¢–ê–ù–û–í–ö–ê –û–°–¨/–ö–ê–†–î–ê–ù>>>",
  "–£–°–¢.–°–ò–°–¢.–ù–ï–ô–¢–†–û–õ–ò–ó–ê–¶–ò–ò–ò>>>",
  "–ü–ï–†–ï–í–û–†–û–¢ –†–ê–ú–´>>>",
  "–£–°–¢.–†–£–õ–ï–í.–ú–ï–•–ê–ù.>>>",
  "–£–°–¢.–†–£–õ–ï–í.–ú–ï–•–ê–ù.>>>",
  "–£–°–¢–ê–ù–û–í–ö–ê –î–í–°>>>",
  "–ó–ê–ü–†–ê–í–ö–ê –†–ê–ó–î.–ö–û–†–û–ë–ö–ò>>>",
  "–£–°–¢–ê–ù–û–í–ö–ê –†–ê–î–ò–ê–¢–û–†–ê>>>",
  "–£–°–¢.–°–ò–°–¢.–ù–ï–ô–¢–†–û–õ–ò–ó–ê–¶–ò–ò–ò>>>",
  "–ó–ê–ü–†.–¶–ò–õ–ò–ù.–ü–û–î–™–ï–ú.–ö–ê–ë–ò–ù>>>",
  "–£–°–¢–ê–ù.–ê–ö–ë –∏ –ë–ê–ö–ê>>>",
  "–£–°–¢–ê–ù.–ê–ö–ë –∏ –ë–ê–ö–ê>>>",
  "–£–°–¢–ê–ù–û–í–ö–ê –ö–û–õ–Å–°>>>",
  "–£–°–¢–ê–ù–û–í–ö–ê –ö–û–õ–Å–°>>>",
  "–£–°–¢–ê–ù–û–í–ö–ê –ö–û–õ–Å–°>>>",
  "–£–°–¢–ê–ù–û–í–ö–ê –ö–ê–ë–ò–ù–´>>>",
  "–£–°–¢–ê–ù.–°–ï–î-–°–¶–ï–ü–ù.–£–°–¢-–í–ê>>>",
  "–£–°–¢–ê–ù. –ù–ê–î–†–ê–ú–ù–ò–ö–ê>>>",
  "–£–°–¢–ê–ù. –û–ü–ï–†–ï–ù–ò–Ø>>>",
  "–ó–ê–ü–†–ê–í–ö–ê –î–¢ –∏ –û–ñ>>>",
  "–ó–ê–ü–†–ê–í–ö–ê –°–¶–ï–ü–õ–ï–ù–ò–Ø>>>",
  "–ó–ê–í–û–î–ö–ê –ê–í–¢–û–ú–û–ë–ò–õ–Ø>>>",
  "–ü–†–û–í–ï–†–ö–ê –¢–û–†–ú–û–ó–ù.–°–ò–°-–ú–´>>>",
  "–ü–†–û–í–ï–†–ö–ê –°–¶–ï–ü–õ–ï–ù–ò–Ø>>>",
  "–°–™–ï–ó–î –° –ö–û–ù–í–ï–ô–ï–†–ê>>>"
];
function createTableRows() {
  const tbody = document.getElementById("stoykiBody");
  tbody.innerHTML = "";
positions.forEach((pos, index) => {
  const row = document.createElement("tr");

  const nameTd = document.createElement("td");
  nameTd.id = pos.id;
  nameTd.textContent = pos.name;
  nameTd.dataset.originalName = pos.name;
  nameTd.style.cursor = "pointer";
  nameTd.title = "–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤—ã";

  nameTd.addEventListener("click", () => {
    showStopDetailsFor(pos.id);
  });

  row.appendChild(nameTd);

  // –û—Å—Ç–∞–ª—å–Ω—ã–µ —è—á–µ–π–∫–∏
  const cur = document.createElement("td");
  cur.id = `${pos.id}_cur`;
  cur.textContent = "‚Äî";

  const sum = document.createElement("td");
  sum.id = `${pos.id}_sum`;
  sum.textContent = "‚Äî";

  const prog = document.createElement("td");
  prog.id = `${pos.id}_prog`;
  prog.style.padding = "8px 4px";
  prog.textContent = "‚Äî";

  row.appendChild(cur);
  row.appendChild(sum);
  row.appendChild(prog);

  if (index === 0) {
    const historyTd = document.createElement("td");
    historyTd.className = "history-cell";
    historyTd.rowSpan = positions.length;
    historyTd.innerHTML = `
      <div class="history-scroll" id="historyContent">
        <div class="history-empty">–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...</div>
      </div>
    `;
    row.appendChild(historyTd);
  }

  tbody.appendChild(row);
});
 
}
let cachedIntervals = {}; // –∫—ç—à–∏—Ä—É–µ–º, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑

function showStopDetailsFor(posId) {
  console.log("–ö–ª–∏–∫ –ø–æ —Å—Ç–æ–π–∫–µ:", posId, "–¥–∞–Ω–Ω—ã—Ö –≤ lastGrafData:", !!lastGrafData?.length);
  if (cachedIntervals[posId]) {
    showStopDetails(posId, cachedIntervals[posId]);
    return;
  }

  const field = posId === 'cep' ? 'cep_inf' : `${posId}_`;
  const intervals = getStopIntervals(lastGrafData, field); // lastGrafData ‚Äî –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è

  cachedIntervals[posId] = intervals;
  showStopDetails(posId, intervals);
}
function updateHistory(listOstan) {
  const container = document.getElementById("historyContent");
  if (!container) return;

  container.innerHTML = "";

  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Å—Ç—Ä–æ–∫–∏
  let items = (listOstan || []).map(item => item.na_lente?.trim() || "‚Äî");

  // üî• –£–¥–∞–ª—è–µ–º —Ö–≤–æ—Å—Ç –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ / –ø—Ä–æ—á–µ—Ä–∫–æ–≤
  while (items.length > 0 && (items[items.length - 1] === "‚Äî" || items[items.length - 1] === "")) {
    items.pop();
  }

  const div = document.createElement("div");

  const max = Math.max(positionLabels.length, items.length);

  for (let i = 0; i < max; i++) {
    const line = document.createElement("div");

    const left  = positionLabels[i] || "";
    let right = items[i] || "";

    // üî• –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ: –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö
    if (i === 0 && (right === "‚Äî" || right === "")) {
      right = "–ù–ï–¢ –ó–ê–î–ê–ù–ò–Ø";
    }

    if (i < positionLabels.length && i < items.length) {
      // –ï—Å—Ç—å –∏ –ø–æ–∑–∏—Ü–∏—è, –∏ –∑–Ω–∞—á–µ–Ω–∏–µ
      line.style.display = "flex";
      line.style.justifyContent = "space-between";
      line.style.gap = "10px";

      const leftSpan = document.createElement("span");
      leftSpan.textContent = left;

      const rightSpan = document.createElement("span");
      rightSpan.textContent = right;

      // –ú–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –∫—Ä–∞—Å–Ω—ã–º, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å
      if (right === "–ù–ï–¢ –ó–ê–î–ê–ù–ò–Ø") {
        rightSpan.style.color = "red";
        rightSpan.style.fontWeight = "bold";
      }

      line.appendChild(leftSpan);
      line.appendChild(rightSpan);

    } else if (i < positionLabels.length) {
      // –ü–æ–∑–∏—Ü–∏–∏ –µ—Å—Ç—å, –∞ –∑–Ω–∞—á–µ–Ω–∏—è —É–∂–µ –Ω–µ—Ç
      line.style.display = "flex";
      line.style.justifyContent = "space-between";

      const leftSpan = document.createElement("span");
      leftSpan.textContent = left;

      const rightSpan = document.createElement("span");
      rightSpan.textContent = "‚Äî";

      line.appendChild(leftSpan);
      line.appendChild(rightSpan);

    } else {
      // –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å, –Ω–æ –µ—Å—Ç—å —Ö–≤–æ—Å—Ç –∑–Ω–∞—á–µ–Ω–∏–π
      line.style.textAlign = "center";
      line.textContent = right;
    }

    div.appendChild(line);
  }

  container.appendChild(div);
}

function highlightActiveStops(pressCounts) {
  // –≠–ª–µ–º–µ–Ω—Ç –∫–æ–Ω–≤–µ–π–µ—Ä–∞
  const conveyor = document.getElementById("cep");
  let anyActive = false;

  positions.forEach(pos => {
    const nameElem = document.getElementById(pos.id);
    const curElem  = document.getElementById(pos.id + "_cur");

    if (!nameElem || !curElem) return;

    const value = curElem.textContent.trim();
      const isActive = value !== "___" && value !== "‚Äî";
   //   const isActive = false;  //–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å
 //     const isActive = true;   //–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å
    // –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –ø–æ–∑–∏—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞, –ø–æ–º–µ—á–∞–µ–º —ç—Ç–æ –¥–ª—è –∫–æ–Ω–≤–µ–π–µ—Ä–∞
    if (isActive) anyActive = true;

    // 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–º –∏ —Å—á–µ—Ç—á–∏–∫–æ–º
    const count = pressCounts[pos.id] || 0;
    if (!nameElem.dataset.originalName) {
      nameElem.dataset.originalName = nameElem.textContent.trim();
    }

    let displayText = nameElem.dataset.originalName;
    if (count > 0) {
      displayText += ` (${count})`;
    }
    
    if (nameElem.textContent !== displayText) {
      nameElem.textContent = displayText;
    }

    // 2. –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—è
    if (isActive) {
      Object.assign(nameElem.style, {
        color: "#c0392b",
        fontWeight: "bold",
        backgroundColor: "rgba(231, 76, 60, 0.08)",
        padding: "2px 6px",
        borderLeft: "4px solid #e74c3c"
      });
      nameElem.classList.add("active-pulse");
    } else {
      Object.assign(nameElem.style, {
        color: "#2c3e50",
        fontWeight: "normal",
        backgroundColor: "",
        padding: "",
        borderLeft: ""
      });
      nameElem.classList.remove("active-pulse");
    }
  });

  // 3. –õ–æ–≥–∏–∫–∞ –¥–ª—è div id="cep" (–ö–æ–Ω–≤–µ–π–µ—Ä)
  if (conveyor) {
    if (anyActive) {
      // –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ—Å—Ç–æ–π, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ
      conveyor.classList.remove("conveyor-moving");
      conveyor.classList.add("conveyor-stopped");
    } else {
      // –ï—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ–µ–≤ –Ω–µ—Ç (isActive=0 –¥–ª—è –≤—Å–µ—Ö), –∑–∞–ø—É—Å–∫–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ
      conveyor.classList.add("conveyor-moving");
      conveyor.classList.remove("conveyor-stopped");
    }
  }
}

async function loadData() {
    if (isLoading) return;

    if (isTodaySelected()) startAutoUpdate();
    updateAutoStatus(); // –æ–±—ã—á–Ω—ã–π —Å—Ç–∞—Ç—É—Å


    isLoading = true;
    updateAutoStatus("loading");   // ‚Üê –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–ó–∞–≥—Ä—É–∑–∫–∞..."
    const dateInput = document.getElementById("date").value;
    if (!dateInput) return;

    isLoading = true;

    try {
        const dateStr = dateInput.replace(/-/g, "_");

        const res = await fetch(`/data?date=${dateStr}`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        const data = await res.json();
        lastGrafData = data.graf_;
        cachedIntervals = {};

        const now = Date.now();

        // üî• –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã
        if (isTodaySelected()) {
            if (now - lastSuccessfulLoadTime < 9000) {
                console.log("–°–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ –ø–æ—Å–ª–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ–≥–æ–¥–Ω—è)");
                return;
            }
        }

        // --- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ DOM ---
        document.getElementById("sys_time").textContent =
            `–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è: ${data.data_on_line?.[2]?.inf1_?.trim() ?? "‚Äî"}`;

        document.getElementById("cep_run").textContent =
            `–í—Ä–µ–º—è –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–ø–∏: ${data.data_on_line?.[2]?.inf2_?.trim() ?? "‚Äî"}`;

      const value = data.data_on_line?.[2]?._data?.trim() ?? "‚Äî";
      document.getElementById("vip").innerHTML = `–í—ã–ø—É—â–µ–Ω–æ –ø—Ä–æ–¥—É–∫—Ü–∏–∏: <span class="highlight">${value}</span>`;


        document.getElementById("cep_cur").textContent =   data.data_on_line[0].cep_inf; //–¶–ï–ü–¨                   cep_inf 
        document.getElementById("cep_sum").textContent =   data.data_on_line[1].cep_inf; //–¶–ï–ü–¨           
        document.getElementById("inf1_cur").textContent =  data.data_on_line[0].inf1_;  //–ü–û–ó-1 "–ó–∞–∫–ª–∞–¥–∫–∞        inf1_
        document.getElementById("inf1_sum").textContent =  data.data_on_line[1].inf1_;  //–ü–û–ó-1 "–ó–∞–∫–ª–∞–¥–∫–∞
        document.getElementById("inf2_cur").textContent =  data.data_on_line[0].inf2_;  //–ü–û–ó-3 "–ú–æ—Å—Ç"           inf2_
        document.getElementById("inf2_sum").textContent =  data.data_on_line[1].inf2_;  //–ü–û–ó-3 "–ú–æ—Å—Ç"
        document.getElementById("inf3_cur").textContent =  data.data_on_line[0].inf3_;  //–ü–û–ó-5 "–ö–∞—Ä–¥–∞–Ω"         inf3_
        document.getElementById("inf3_sum").textContent =  data.data_on_line[1].inf3_;  //–ü–û–ó-5 "–ö–∞—Ä–¥–∞–Ω"
        document.getElementById("inf4_cur").textContent =  data.data_on_line[0].inf4_;  //–ü–û–ó-7 "–ü–µ—Ä–µ–≤–æ—Ä–æ—Ç"      inf4_
        document.getElementById("inf4_sum").textContent =  data.data_on_line[1].inf4_;  //–ü–û–ó-7 "–ü–µ—Ä–µ–≤–æ—Ä–æ—Ç"
        document.getElementById("inf5_cur").textContent =  data.data_on_line[0].inf5_;  //–ü–û–ó-10 "–î–≤–∏–≥–∞—Ç–µ–ª—å"     inf5_
        document.getElementById("inf5_sum").textContent =  data.data_on_line[1].inf5_;  //–ü–û–ó-10 "–î–≤–∏–≥–∞—Ç–µ–ª—å"
        document.getElementById("inf6_cur").textContent =  data.data_on_line[0].inf6_;  //–ü–û–ó-14 "–†–∞–¥–∏–∞—Ç–æ—Ä"      inf6_
        document.getElementById("inf6_sum").textContent =  data.data_on_line[1].inf6_;  //–ü–û–ó-14 "–†–∞–¥–∏–∞—Ç–æ—Ä"
        document.getElementById("inf7_cur").textContent =  data.data_on_line[0].inf9_;  //–ü–û–ó-23 "–ó–∞–ø—Ä–∞–≤–∫–∞"      inf9_
        document.getElementById("inf7_sum").textContent =  data.data_on_line[1].inf9_;  //–ü–û–ó-23 "–ó–∞–ø—Ä–∞–≤–∫–∞"
        document.getElementById("inf8_cur").textContent =  data.data_on_line[0].inf7_;  //–ü–û–ó-26 "–ö–∞–±–∏–Ω–∞"        inf7_
        document.getElementById("inf8_sum").textContent =  data.data_on_line[1].inf7_;  //–ü–û–ó-26 "–ö–∞–±–∏–Ω–∞"
        document.getElementById("inf9_cur").textContent =  data.data_on_line[0].inf8_;  //–ü–û–ó-29 "–ù–∞–¥—Ä–∞–º–Ω–∏–∫"     inf8_
        document.getElementById("inf9_sum").textContent =  data.data_on_line[1].inf8_;  //–ü–û–ó-29 "–ù–∞–¥—Ä–∞–º–Ω–∏–∫"
        document.getElementById("inf10_cur").textContent = data.data_on_line[0].inf11_;//–ù–∞—Ç—è–∂–∏—Ç–µ–ª—å —Ü–µ–ø–∏ (–ø–æ–¥–≤–∞–ª)inf11_
        document.getElementById("inf10_sum").textContent = data.data_on_line[1].inf11_;//–ù–∞—Ç—è–∂–∏—Ç–µ–ª—å —Ü–µ–ø–∏ (–ø–æ–¥–≤–∞–ª)
        document.getElementById("inf11_cur").textContent = data.data_on_line[0].inf10_;//–ü–û–ó-32 –°–ø—É—Å–∫           inf10_
        document.getElementById("inf11_sum").textContent = data.data_on_line[1].inf10_;//–ü–û–ó-32 –°–ø—É—Å–∫
        document.getElementById("inf12_cur").textContent = data.data_on_line[0].inf12_;//FX5U "–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä"      inf12_
        document.getElementById("inf12_sum").textContent = data.data_on_line[1].inf12_;//FX5U "–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä"

        updateHistory(data.list_ostan || []);
        _graf2(data.graf_);
        const pressCounts = countPresses(data.graf_);
        highlightActiveStops(pressCounts);
        –ø—Ä–æ–≥—Ä–µ—Å—Å_–±–∞—Ä(data);

        lastSuccessfulLoadTime = now;
        updateAutoStatus("loaded");   // ‚Üê –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–ó–∞–≥—Ä—É–∂–µ–Ω–æ" + –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç
    } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", err);
        document.getElementById("autoUpdateStatus").textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö";
    } finally {
        isLoading = false;
    }
}
// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (–º–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –Ω–∞–≤–µ—Ä—Ö, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å)
function timeToSeconds(str) {
    if (!str || str === "___" || str.trim() === "" || str === "‚Äî") return 0;
    const parts = str.trim().split(":").map(Number);
    let sec = 0;
    if (parts.length === 3) sec = parts[0]*3600 + parts[1]*60 + parts[2];
    else if (parts.length === 2) sec = parts[0]*60 + parts[1];
    else if (parts.length === 1) sec = parts[0];
    return sec || 0;
}
function –ø—Ä–æ–≥—Ä–µ—Å—Å_–±–∞—Ä(data)
{
// ‚îÄ‚îÄ‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –∏ —Å—É–º–º–∞—Ä–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π + –ø—Ä–æ–≥—Ä–µ—Å—Å ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const cur = data.data_on_line?.[0] || {};
const sum = data.data_on_line?.[1] || {};

// –ë–∞–∑–∞ ‚Äî –æ–±—â–µ–µ –≤—Ä–µ–º—è —Ü–µ–ø–∏
const cepTotalStr = (sum.cep_inf || "0:00:00").trim();
const cepTotalSec = timeToSeconds(cepTotalStr);

const mappings = [
    { id: "cep",   field: "cep_inf" },
    { id: "inf1",  field: "inf1_"   },
    { id: "inf2",  field: "inf2_"   },
    { id: "inf3",  field: "inf3_"   },
    { id: "inf4",  field: "inf4_"   },
    { id: "inf5",  field: "inf5_"   },
    { id: "inf6",  field: "inf6_"   },
    { id: "inf7",  field: "inf9_"   },  
    { id: "inf8",  field: "inf7_"   },  
    { id: "inf9",  field: "inf8_"   },
    { id: "inf10", field: "inf11_"  },  
    { id: "inf11", field: "inf10_"  },  
    { id: "inf12", field: "inf12_"  },
];

mappings.forEach(({ id, field }) => {
    const curValue = (cur[field] || "‚Äî").trim();
    const sumValue = (sum[field] || "‚Äî").trim();

    document.getElementById(`${id}_cur`).textContent = curValue;
    document.getElementById(`${id}_sum`).textContent = sumValue;

    // ‚îÄ‚îÄ‚îÄ –ü—Ä–æ–≥—Ä–µ—Å—Å ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const progCell = document.getElementById(`${id}_prog`);
    
    // –ï—Å–ª–∏ —ç—Ç–æ "cep", –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ–º —è—á–µ–π–∫—É –∏ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —ç—Ç–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
    if (id === "cep") {
        progCell.innerHTML = ""; 
        return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –±–∞—Ä–∞ –¥–ª—è cep
    }

    let container = progCell.querySelector(".progress-container");
    if (!container) {
        container = document.createElement("div");
        container.className = "progress-container";
        progCell.innerHTML = "";
        progCell.appendChild(container);
    }

    let bar = container.querySelector(".progress-bar");
    if (!bar) {
        bar = document.createElement("div");
        bar.className = "progress-bar";
        container.appendChild(bar);
    }

    let percent = 0;
    let text = "‚Äî";

    const sumSec = timeToSeconds(sumValue);

    if (cepTotalSec > 0) {
        if (id === "cep") {
            percent = 100;
            text = "100%";
        } else {
            percent = Math.min(100, Math.round((sumSec / cepTotalSec) * 100));
            text = `${percent}%`;
        }
    }
if (id!="cep"){
     bar.style.width = `${percent}%`;
    bar.textContent = text; 
}


    // –°–±—Ä–æ—Å –∏ —Ü–≤–µ—Ç–∞
    bar.className = "progress-bar";
    bar.style.background = "";

    if (percent === 0) {
        bar.style.background = "#f0f0f0";
    } else if (percent < 5) {
        bar.style.background = "#27ae60";          // –∑–µ–ª—ë–Ω—ã–π ‚Äî –º–∞–ª–æ –ø—Ä–æ—Å—Ç–æ—è
    } else if (percent <= 20) {
        bar.style.background = "#f39c12";          // –∂—ë–ª—Ç—ã–π ‚Äî —Å—Ä–µ–¥–Ω–µ
    } else {
        bar.style.background = "#e74c3c";          // –∫—Ä–∞—Å–Ω—ã–π ‚Äî –º–Ω–æ–≥–æ
    }
});
}
function _graf2(data) {
  if (!Array.isArray(data) || data.length < 2) {
    console.error('–û–∂–∏–¥–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –º–∏–Ω–∏–º—É–º –∏–∑ 2 —ç–ª–µ–º–µ–Ω—Ç–æ–≤');
    return;
  }

  // –ò—â–µ–º —Å—Ç—Ä–æ–∫—É —Å –¥–∞—Ç–æ–π (–æ–±—ã—á–Ω–æ –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç)
  let dateStr = null;
  for (let item of data) {
    if (item._data && item._data.trim().match(/^\d{2}-\d{2}-\d{4}$/)) {
      dateStr = item._data.trim();
      break;
    }
  }

  if (!dateStr) {
    console.error('–ù–µ –Ω–∞–π–¥–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞ —Å –¥–∞—Ç–æ–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD-MM-YYYY');
    return;
  }

  const [day, month, year] = dateStr.split('-').map(Number);

  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–π —Å–µ—Ä–∏–∏: [ [timestamp, y –∏–ª–∏ null], ... ]
  const seriesData = seriesConfig.map(() => []);

  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É (–¥–∞—Ç—É) –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ
  data.forEach(item => {
    const timeStr = item._data?.trim();
    if (!timeStr || !timeStr.includes(':')) return; // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫—É —Å –¥–∞—Ç–æ–π –∏ –±–∏—Ç—ã–µ –∑–∞–ø–∏—Å–∏

    // –û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç: " 6:51:46 " ‚Üí —É–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã
    const cleanTime = timeStr.replace(/\s/g, '');
    const [hours, minutes, seconds] = cleanTime.split(':').map(Number);

    if (isNaN(hours) || isNaN(minutes) || isNaN(seconds)) return;

    const timestamp = new Date(Date.UTC(year, month - 1, day, hours, minutes, seconds)).getTime();

    seriesConfig.forEach((config, i) => {
      const val = item[config.field];
      // –†–∏—Å—É–µ–º —Ç–æ—á–∫—É —Ç–æ–ª—å–∫–æ –ø—Ä–∏ "1", –∏–Ω–∞—á–µ null (—Ä–∞–∑—Ä—ã–≤ –ª–∏–Ω–∏–∏)
      const yValue = (val === '1' || val === 1) ? config.y : null;
      seriesData[i].push([timestamp, yValue]);
    });
  });

  // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π (—Ö–æ—Ç—è –¥–∞–Ω–Ω—ã–µ –æ–±—ã—á–Ω–æ –∏–¥—É—Ç –ø–æ –ø–æ—Ä—è–¥–∫—É)
  seriesData.forEach(arr => arr.sort((a, b) => a[0] - b[0]));

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //                  –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Highcharts.chart('container2', {
    chart: {
        type: 'line',
        zoomType: 'x',           // –æ—Å–Ω–æ–≤–Ω–æ–π –∑—É–º –ø–æ X
        panning: true,           // –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∑–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–æ–π
        panKey: 'shift'          // –æ–±—ã—á–Ω–æ shift, –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–µ–Ω
    },

    title: {
        text: `–ì—Ä–∞—Ñ–∏–∫ –æ—Å—Ç–∞–Ω–æ–≤–æ–≤ ‚Äî ${dateStr}`  
    },

    xAxis: {
        type: 'datetime',
        title: {
            text: '–í—Ä–µ–º—è'
        },
        dateTimeLabelFormats: {
            minute: '%H:%M',
            hour:   '%H:%M',
            day:    '%e %b'
        }
    },

    yAxis: {
        title: {
            text: ''
        },
        labels: {
            enabled: false
        },
        gridLineWidth: 0,     // —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ª–∏–Ω–∏–∏ —Å–µ—Ç–∫–∏
        min: 0,
        max: 140
    },

    scrollbar: {
        enabled: true
    },

legend: {
    layout: 'vertical',
    align: 'right',
    verticalAlign: 'middle',       // –æ—Å—Ç–∞–≤–ª—è–µ–º middle ‚Äî —ç—Ç–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –≤–µ—Å—å –±–ª–æ–∫ –ø–æ —Ü–µ–Ω—Ç—Ä—É –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏

    // –ü–æ–¥–Ω–∏–º–∞–µ–º –≤–µ—Å—å –±–ª–æ–∫ –ª–µ–≥–µ–Ω–¥—ã –≤–≤–µ—Ä—Ö (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –≤–≤–µ—Ä—Ö)
    y: -10,                        // ‚Üê –ø–æ–¥–±–µ—Ä–∏ –ø–æ–¥ —Å–µ–±—è: -50 .. -120 (—á–µ–º –±–æ–ª—å—à–µ —à—Ä–∏—Ñ—Ç, —Ç–µ–º –±–æ–ª—å—à–µ —Å–¥–≤–∏–≥ –≤–≤–µ—Ä—Ö)

    // –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É –ª–∏–Ω–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞
    useHTML: true,                 // ‚Üê –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ! –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–æ—á–Ω–µ–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ CSS
    symbolHeight: 16,              // –≤—ã—Å–æ—Ç–∞ —Å–∏–º–≤–æ–ª–∞ (–ª–∏–Ω–∏–∏) ‚Äî —Å–¥–µ–ª–∞–π —á—É—Ç—å –±–æ–ª—å—à–µ –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏
    symbolWidth: 40,               // –¥–ª–∏–Ω–∞ –ª–∏–Ω–∏–∏ ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –≤—ã–≥–ª—è–¥–µ–ª–æ —Å–æ–ª–∏–¥–Ω–µ–µ
    symbolRadius: 0,               // –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —Ä–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü—ã –ª–∏–Ω–∏–π

    itemStyle: {
        fontSize: '13px',          // —Ç–≤–æ–π —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç (–∏–ª–∏ 15‚Äì16px)
        lineHeight: '16px',        // ‚Üê –∫–ª—é—á–µ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä! –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ä–∞–≤–µ–Ω symbolHeight
                                   // –∏–ª–∏ —á—É—Ç—å –±–æ–ª—å—à–µ ‚Äî —Ç–µ–∫—Å—Ç –≤—Å—Ç–∞–Ω–µ—Ç –ø–æ —Ü–µ–Ω—Ç—Ä—É –ª–∏–Ω–∏–∏
        fontWeight: 'normal'
    },

    itemHoverStyle: {
        // –º–æ–∂–Ω–æ –Ω–µ –º–µ–Ω—è—Ç—å, –Ω–æ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
        color: '#000'
    },

    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É –ø—É–Ω–∫—Ç–∞–º–∏ (—á—Ç–æ–±—ã –ª–µ–≥–µ–Ω–¥–∞ –Ω–µ –≤—ã–≥–ª—è–¥–µ–ª–∞ —Å–∂–∞—Ç–æ–π)
    itemMarginTop: 6,
    itemMarginBottom: 6
},

    tooltip: {
        pointFormat: '{series.name}'   // –∫–∞–∫ –±—ã–ª–æ –≤ —Å—Ç–∞—Ä–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ ‚Äî –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–æ
    },

plotOptions: {
    series: {
        animation: false,
        marker: { enabled: false },
        step: 'left'          // –∏–ª–∏ true  ‚Üí  —Å—Ç—É–ø–µ–Ω—å–∫–∏ —Å–ª–µ–≤–∞ / —Å–ø—Ä–∞–≤–∞
    }
},

    series: seriesConfig.map((cfg, i) => ({
        name: cfg.name,
        data: seriesData[i],
        color: Highcharts.getOptions().colors[i % Highcharts.getOptions().colors.length]
    }))
});

}
// key ‚Äî —ç—Ç–æ 'cep_inf', 'inf1_', 'inf2_' –∏ —Ç.–¥.
function getStopIntervals(grafData, key) {
  if (!Array.isArray(grafData) || grafData.length < 2) return [];

  // ‚îÄ‚îÄ‚îÄ –í—ã–Ω–æ—Å–∏–º —Å—é–¥–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const dateInput = document.getElementById("date").value;
  const baseDate = dateInput ? new Date(dateInput) : new Date();
  baseDate.setHours(0, 0, 0, 0);
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  const intervals = [];
  let startTime = null;

  grafData.slice(1).forEach((row) => {
    const timeStr = row._data?.trim();
    if (!timeStr || !timeStr.includes(':')) return;

    const cleanTime = timeStr.replace(/\s/g, '');
    const [h, m, s = 0] = cleanTime.split(':').map(Number);   

    if (isNaN(h) || isNaN(m)) return;   // –∑–∞—â–∏—Ç–∞

    const timestamp = new Date(baseDate);        
    timestamp.setHours(h, m, s, 0);

    const value = (row[key] || "0").trim();

    if (value === "1" || value === 1) {
      if (startTime === null) {
        startTime = timestamp;
      }
    } else {
      if (startTime !== null) {
        intervals.push({
          start: startTime,
          end: timestamp,
          duration: formatDuration(timestamp - startTime)
        });
        startTime = null;
      }
    }
  });

  // –ï—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ–π –∏–¥—ë—Ç –¥–æ –∫–æ–Ω—Ü–∞
  if (startTime !== null) {
    const lastRow = grafData[grafData.length - 1];
    const lastTimeStr = lastRow._data?.trim().replace(/\s/g, '');
    const [lh, lm, ls = 0] = lastTimeStr.split(':').map(Number);

    if (!isNaN(lh) && !isNaN(lm)) {
      const lastTs = new Date(baseDate);        
      lastTs.setHours(lh, lm, ls, 0);

      intervals.push({
        start: startTime,
        end: lastTs,
        duration: formatDuration(lastTs - startTime),
        ongoing: true
      });
    }
  }

  return intervals;
}
function showStopDetails(posId, intervals) {
  if (intervals.length === 0) {
    alert(`–ü–æ —Å—Ç–æ–π–∫–µ ${posId} –û—Å—Ç–∞–Ω–æ–≤–æ–≤ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ`);
    return;
  }

const niceTitle = stopModalTitles[posId] || `–û—Å—Ç–∞–Ω–æ–≤—ã ${posId}`;
let html = `<h3>${niceTitle}</h3><ul style="padding-left: 20px; line-height: 1.6;">`;

intervals.forEach(int => {
  const start = int.start.toLocaleTimeString('ru-RU', { hour12: false });
  const end   = int.ongoing ? "‚Äî" : int.end.toLocaleTimeString('ru-RU', { hour12: false });
  const dur   = int.duration;
  const status = int.ongoing ? " (–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è)" : "";
html += `
  <li style="
    background:#f7f7f7;
    margin:6px 0;
    padding:10px 14px;
    border-radius:8px;
    list-style:none;
    box-shadow:0 1px 3px rgba(0,0,0,0.1);
  ">
    <div style="font-size:15px;">
      <b>${start}</b> ‚Äî <b>${end}</b>
      <span style="
        background:#3498db;
        color:white;
        padding:2px 6px;
        border-radius:4px;
        font-size:12px;
        margin-left:6px;
      ">${dur}</span>
      ${status ? `<span style="
        background:#e67e22;
        color:white;
        padding:2px 6px;
        border-radius:4px;
        font-size:12px;
        margin-left:6px;
      ">–∏–¥—ë—Ç —Å–µ–π—á–∞—Å</span>` : ""}
    </div>
  </li>
`;
});
  html += `</ul>
           <p style="margin-top: 15px; font-weight: bold;">
             –í—Å–µ–≥–æ –æ—Å—Ç–∞–Ω–æ–≤–æ–≤: ${intervals.length}
           </p>`;

  const modal = document.createElement('div');
  modal.style.position = 'fixed';
  modal.style.inset = '0';
  modal.style.background = 'rgba(0,0,0,0.65)';
  modal.style.display = 'flex';
  modal.style.alignItems = 'center';
  modal.style.justifyContent = 'center';
  modal.style.zIndex = '9999';

  const content = document.createElement('div');
  content.style.background = 'white';
  content.style.padding = '24px';
  content.style.borderRadius = '12px';
  content.style.maxWidth = '580px';
  content.style.maxHeight = '85vh';
  content.style.overflowY = 'auto';
  content.style.boxShadow = '0 10px 30px rgba(0,0,0,0.3)';
  content.innerHTML = html + '<br><button style="margin-top:15px; padding:10px 20px; background:#e74c3c; color:white; border:none; border-radius:6px; cursor:pointer;" onclick="this.closest(\'div\').parentNode.remove()">–ó–∞–∫—Ä—ã—Ç—å</button>';

  modal.appendChild(content);
  document.body.appendChild(modal);

  modal.addEventListener('click', e => {
    if (e.target === modal) modal.remove();
  });
}
function formatDuration(ms) {
  if (!ms || ms <= 0) return "‚Äî";

  const sec = Math.floor(ms / 1000);
  const h = Math.floor(sec / 3600);
  const m = Math.floor((sec % 3600) / 60);
  const s = sec % 60;

  return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
}
function countPresses(grafData) {
  if (!Array.isArray(grafData) || grafData.length < 2) return {};

  const counts = {
    cep: 0,
    inf1: 0, inf2: 0, inf3: 0, inf4: 0, inf5: 0,
    inf6: 0, inf7: 0, inf8: 0, inf9: 0, inf10: 0,
    inf11: 0, inf12: 0
  };

  const prev = {}; // –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏

  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É (–¥–∞—Ç—É)
  grafData.slice(1).forEach(row => {
    Object.keys(counts).forEach(key => {
      const field = key === 'cep' ? 'cep_inf' : `${key}_`;
      const current = (row[field] || '0').trim();

      if (!prev.hasOwnProperty(key)) {
        prev[key] = current; // –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –Ω–µ —Å—á–∏—Ç–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥–æ–º
      } else if (prev[key] === '0' && current === '1') {
        counts[key]++;
      }

      prev[key] = current;
    });
  });
  return counts;
document.getElementById("date").addEventListener("change", () => {
    updateAutoStatus();

    // 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª—é–±–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–∞–π–º–µ—Ä
    if (updateTimer) {
        clearTimeout(updateTimer);
        updateTimer = null;
    }

    // 2. –û—á–∏—â–∞–µ–º –∫—ç—à –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
    cachedIntervals = {};

    // 3. –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    loadData().then(() => {
        // 4. –ï—Å–ª–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—Ç–∞ ‚Äî —Å–µ–≥–æ–¥–Ω—è ‚Üí –∑–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        if (isTodaySelected()) {
            startAutoUpdate();
            loadData();  // ‚Üê –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
        }
    });
});
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener("DOMContentLoaded", () => {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
    document.getElementById("date").value = new Date().toISOString().slice(0, 10);

    createTableRows();

    // –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ + –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è)
    loadData().then(() => {
    console.log("–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –°–µ–≥–æ–¥–Ω—è?", isTodaySelected());
    if (isTodaySelected()) {
        console.log("–î–æ–ª–∂–Ω—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ");
        startAutoUpdate();
    }
        updateAutoStatus();
    });
});
// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
function updateUsers() {
  fetch('/users')
    .then(response => response.json())
    .then(data => {
      const tbody = document.getElementById('usersBody');
      tbody.innerHTML = '';  // –æ—á–∏—â–∞–µ–º

      if (data.users.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">–ù–∏–∫—Ç–æ –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω</td></tr>';
        return;
      }

      data.users.forEach(user => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${user.last_seen}</td>
          <td>${user.ip}</td>
          <td>${user.hostname}</td>
          <td>${user.requests}</td>
          <td>${user.user_agent || '‚Äî'}</td>
        `;
        tbody.appendChild(row);
      });
    })
    .catch(err => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', err));
}

// // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
// setInterval(updateUsers, 10000);
// updateUsers();  // —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

// –¢–≤–æ—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è (–º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å)
const REQUIRED_KEYS = {
  ctrl: true,
  shift: true,
  key: 'U'
};

let pressed = { ctrl: false, shift: false };
let hideTimer = null;

function showUsersBlock() {
  const block = document.getElementById("password");
  block.style.display = "block";
  updateUsers(); // —Å—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ

  // –ê–≤—Ç–æ-—Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 20 —Å–µ–∫—É–Ω–¥
  clearTimeout(hideTimer);
  hideTimer = setTimeout(() => {
    block.style.display = "none";
    console.log("–°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç —á–µ—Ä–µ–∑ 20 —Å–µ–∫");
  }, 20000); // 20 000 –º—Å = 20 —Å–µ–∫—É–Ω–¥
}

document.addEventListener('keydown', function(e) {
  if (e.key === 'Control') pressed.ctrl = true;
  if (e.key === 'Shift')   pressed.shift = true;

  if (pressed.ctrl && pressed.shift && e.key.toUpperCase() === REQUIRED_KEYS.key) {
    e.preventDefault();
    
    const block = document.getElementById("password");
    if (block.style.display === "none") {
      showUsersBlock();
    } else {
      clearTimeout(hideTimer);
      block.style.display = "none";
    }
  }
});

document.addEventListener('keyup', function(e) {
  if (e.key === 'Control') pressed.ctrl = false;
  if (e.key === 'Shift')   pressed.shift = false;
});
function setToday() {
  document.getElementById("date").value = new Date().toISOString().slice(0, 10);
  loadData();
}
</script>

</body>
</html>
